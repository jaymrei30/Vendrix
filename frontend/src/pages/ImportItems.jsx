import React,{useState} from 'react'
import * as XLSX from 'xlsx'
export default function ImportItems(){
  const [rows,setRows]=useState([])
  const onFile=async(e)=>{const file=e.target.files?.[0];if(!file)return;const data=await file.arrayBuffer();const wb=XLSX.read(data,{type:'array'});const ws=wb.Sheets[wb.SheetNames[0]];const json=XLSX.utils.sheet_to_json(ws,{defval:''});setRows(json)}
  const upload=async()=>{try{const r=await fetch((import.meta.env.VITE_API_BASE||'http://localhost:8000')+'/api/import/items',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({items:rows})});if(!r.ok)throw new Error('Upload failed');alert('Import sent to server.')}catch(err){console.error(err);alert('Demo only: parsed file, ready for API hookup.')}}
  return (<div className="space-y-4"><h2 className="text-lg font-semibold">Import Items from Excel</h2><div className="bg-white dark:bg-gray-800 p-3 rounded shadow flex items-center gap-2"><input type="file" accept=".xlsx,.xls" onChange={onFile}/><button onClick={upload} className="px-3 py-2 bg-indigo-600 text-white rounded" disabled={!rows.length}>Upload</button></div><div className="bg-white dark:bg-gray-800 p-3 rounded shadow"><h3 className="font-semibold mb-2">Preview ({rows.length})</h3><div className="overflow-auto"><table className="min-w-full text-sm"><thead><tr className="text-left text-gray-500 dark:text-gray-300"><th>itemno</th><th>description</th><th>unit</th><th>price</th><th>quantity</th></tr></thead><tbody>{rows.map((r,i)=>(<tr key={i}><td>{r.itemno}</td><td>{r.description}</td><td>{r.unit}</td><td>{r.price}</td><td>{r.quantity}</td></tr>))}{!rows.length&&<tr><td colSpan="5" className="text-center py-4 text-gray-500">No data loaded</td></tr>}</tbody></table></div></div></div>)}
